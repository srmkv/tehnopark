{"version":3,"sources":["identify.ts"],"names":["Identify","constructor","payload","set","key","value","addOp","OP_SET","setOnce","OP_SET_ONCE","add","OP_ADD","unset","OP_UNSET","append","OP_APPEND","op","ALL_OPS","includes","Error","String","opMap","Object","prototype","hasOwnProperty","call"],"mappings":";;AAAA,OAAO,MAAMA,QAAN,CAAe;AAiBpBC,EAAAA,WAAW,GAAG;AAAA;;AACZ,SAAKC,OAAL,GAAe,EAAf;AACD;;AAEDC,EAAAA,GAAG,CAACC,GAAD,EAAcC,KAAd,EAAoC;AACrC,SAAKC,KAAL,CAAWN,QAAQ,CAACO,MAApB,EAA4BH,GAA5B,EAAiCC,KAAjC;AACD;;AAEDG,EAAAA,OAAO,CAACJ,GAAD,EAAcC,KAAd,EAAoC;AACzC,SAAKC,KAAL,CAAWN,QAAQ,CAACS,WAApB,EAAiCL,GAAjC,EAAsCC,KAAtC;AACD;;AAEDK,EAAAA,GAAG,CAACN,GAAD,EAAcC,KAAd,EAAmC;AACpC,SAAKC,KAAL,CAAWN,QAAQ,CAACW,MAApB,EAA4BP,GAA5B,EAAiCC,KAAjC;AACD;;AAEDO,EAAAA,KAAK,CAACR,GAAD,EAAoB;AACvB,SAAKE,KAAL,CAAWN,QAAQ,CAACa,QAApB,EAA8BT,GAA9B,EAAmC,GAAnC;AACD;;AAEDU,EAAAA,MAAM,CAACV,GAAD,EAAcC,KAAd,EAAoC;AACxC,SAAKC,KAAL,CAAWN,QAAQ,CAACe,SAApB,EAA+BX,GAA/B,EAAoCC,KAApC;AACD;;AAEOC,EAAAA,KAAR,CAAcU,EAAd,EAA0BZ,GAA1B,EAAuCC,KAAvC,EAA6D;AAC3D,QAAI,CAACL,QAAQ,CAACiB,OAAT,CAAiBC,QAAjB,CAA0BF,EAA1B,CAAL,EAAoC;AAClC,YAAM,IAAIG,KAAJ,uCAC2BH,EAD3B,+BACkDZ,GADlD,qBACgEgB,MAAM,CACxEf,KADwE,CADtE,EAAN;AAKD;;AACD,SAAKgB,KAAL,CAAWL,EAAX,EAAeZ,GAAf,IAAsBC,KAAtB;AACD;;AAEOgB,EAAAA,KAAR,CAAcjB,GAAd,EAAoD;AAClD,QAAI,CAACkB,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC,KAAKvB,OAA1C,EAAmDE,GAAnD,CAAL,EAA8D;AAC5D,WAAKF,OAAL,CAAaE,GAAb,IAAoB,EAApB;AACD;;AACD,WAAO,KAAKF,OAAL,CAAaE,GAAb,CAAP;AACD;;AAzDmB;;gBAATJ,Q,YAGa,M;;gBAHbA,Q,iBAIkB,U;;gBAJlBA,Q,YAKa,M;;gBALbA,Q,eAMgB,S;;gBANhBA,Q,cAOe,Q;;gBAPfA,Q,aASc,CACvBA,QAAQ,CAACO,MADc,EAEvBP,QAAQ,CAACS,WAFc,EAGvBT,QAAQ,CAACW,MAHc,EAIvBX,QAAQ,CAACe,SAJc,EAKvBf,QAAQ,CAACa,QALc,C","sourcesContent":["export class Identify {\n  payload: Record<string, Record<string, unknown>>;\n\n  private static OP_SET = '$set';\n  private static OP_SET_ONCE = '$setOnce';\n  private static OP_ADD = '$add';\n  private static OP_APPEND = '$append';\n  private static OP_UNSET = '$unset';\n\n  private static ALL_OPS = [\n    Identify.OP_SET,\n    Identify.OP_SET_ONCE,\n    Identify.OP_ADD,\n    Identify.OP_APPEND,\n    Identify.OP_UNSET,\n  ];\n\n  constructor() {\n    this.payload = {};\n  }\n\n  set(key: string, value: unknown): void {\n    this.addOp(Identify.OP_SET, key, value);\n  }\n\n  setOnce(key: string, value: unknown): void {\n    this.addOp(Identify.OP_SET_ONCE, key, value);\n  }\n\n  add(key: string, value: number): void {\n    this.addOp(Identify.OP_ADD, key, value);\n  }\n\n  unset(key: string): void {\n    this.addOp(Identify.OP_UNSET, key, '-');\n  }\n\n  append(key: string, value: unknown): void {\n    this.addOp(Identify.OP_APPEND, key, value);\n  }\n\n  private addOp(op: string, key: string, value: unknown): void {\n    if (!Identify.ALL_OPS.includes(op)) {\n      throw new Error(\n        `Unknown Identify operation: ${op} called with key: ${key} value: ${String(\n          value,\n        )}`,\n      );\n    }\n    this.opMap(op)[key] = value;\n  }\n\n  private opMap(key: string): Record<string, unknown> {\n    if (!Object.prototype.hasOwnProperty.call(this.payload, key)) {\n      this.payload[key] = {};\n    }\n    return this.payload[key];\n  }\n}\n"]}